package keystrokesmod.module.impl.exploit.disabler;

import keystrokesmod.event.PreMotionEvent;
import keystrokesmod.module.impl.exploit.Disabler;
import keystrokesmod.module.impl.exploit.disabler.hypixel.HypixelMotionDisabler;
import keystrokesmod.module.setting.impl.ButtonSetting;
import keystrokesmod.module.setting.impl.LiteralSubMode;
import keystrokesmod.module.setting.impl.ModeValue;
import keystrokesmod.module.setting.impl.SubMode;
import keystrokesmod.utility.MoveUtil;
import net.minecraftforge.fml.common.eventhandler.EventPriority;
import net.minecraftforge.fml.common.eventhandler.SubscribeEvent;
import org.jetbrains.annotations.NotNull;

public class HypixelDisabler extends SubMode<Disabler> {
    public final ModeValue motion;
    private final ButtonSetting sprint;

    public HypixelDisabler(String name, @NotNull Disabler parent) {
        super(name, parent);
        this.registerSetting(motion = new ModeValue("Motion Disabler", this)
                .add(new LiteralSubMode("Disabled", this))
                .add(new HypixelMotionDisabler("Enabled", this))
        );
        this.registerSetting(sprint = new ButtonSetting("Sprint", false));
    }

    @Override
    public void onEnable() {
        motion.enable();
    }

    @Override
    public void onDisable() {
        motion.disable();
    }

    @SubscribeEvent(priority = EventPriority.HIGHEST)
    public void onPreMotion(PreMotionEvent event) {
        if (sprint.isToggled() && MoveUtil.getSpeedEffect() == 0 && !MoveUtil.canSprint(true))
            event.setSprinting(false);
    }
}
